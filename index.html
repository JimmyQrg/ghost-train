<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Login | Classlink</title>
<link rel="icon" type="image/png" href="pausd-icon.png">
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: black;
    font-family: 'Press Start 2P', monospace;
  }
  canvas { display: block; }
  #ui {
    position: absolute; top: 0; left: 0;
    width: 100%; height: 100%;
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    background: black; color: white; text-align: center;
  }
  #ui h1 {
    font-size: 32px; color: white; text-shadow: 0 0 20px white;
    margin-bottom: 30px;
  }
  .menuBtn {
    border: 2px solid white; color: white;
    padding: 12px 40px; margin: 12px;
    font-size: 14px; cursor: pointer;
    background: transparent; font-family: 'Press Start 2P', monospace;
    text-shadow: 0 0 10px white;
    box-shadow: 0 0 15px white inset, 0 0 15px white;
  }
  #howToPlayBox {
    position: absolute; top: 10%; left: 20%; width: 60%; height: 70%;
    background: rgba(0,0,0,0.9); border: 2px solid white;
    color: white; font-size: 12px; overflow-y: auto; display: none;
    padding: 20px; line-height: 1.8; text-align: left;
  }
  #howToPlayBox h2 { text-align: center; margin-top: 0; }
  #closeHowTo {
    position: absolute; top: 10px; right: 10px;
    font-size: 20px; cursor: pointer; color: white;
  }
  #strikeButton {
    position: absolute; bottom: 40px; right: 40px;
    width: 80px; height: 80px; border-radius: 50%;
    border: 2px solid purple; background: black;
    box-shadow: 0 0 20px purple, inset 0 0 20px purple;
    display: none; cursor: pointer;
  }
</style>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
<canvas id="gameCanvas"></canvas>

<div id="ui">
  <h1>GHOST TRAIN CUBE</h1>
  <button id="startBtn" class="menuBtn">START</button>
  <button id="howToBtn" class="menuBtn">HOW TO PLAY</button>
  <p>Best: <span id="bestScoreText">0</span></p>
</div>

<div id="howToPlayBox">
  <span id="closeHowTo">✖</span>
  <h2>GHOST TRAIN CUBE</h2>
  <h3>How to Play</h3>
  <p><b>Controls:</b>  
  W / Space / ↑ / Tap / Click → Switch grounds  
  Q / Tab / Purple Button → Destroy nearby white strikes</p>
  <p><b>Rules:</b><br>
  • Avoid all strikes.  
  • Red = regular strike.  
  • Purple = faster strike, jumps once to the other ground.  
  • White = destroyable if within 2 blocks.  
  • Gems = collect for +10 score (middle lane).</p>
  <p><b>Scoring:</b><br>
  +1 each time you switch grounds.  
  +10 for each gem collected.</p>
</div>

<button id="strikeButton"></button>

<script>
const canvas=document.getElementById("gameCanvas");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth; canvas.height=window.innerHeight;

// Globals
let gameRunning=false, score=0, bestScore=localStorage.getItem("ghostTrainBest")||0;
document.getElementById("bestScoreText").textContent=bestScore;

let groundHeight=8, scrollSpeed=6;
let topGroundY=100, bottomGroundY=canvas.height-100;

// Player
const player={x:150,y:bottomGroundY-30,width:30,height:30,targetY:bottomGroundY-30,lane:1};

// Arrays
let strikes=[], gems=[], particles=[], floatingScores=[], trails=[];

// Particles
function spawnParticles(x,y,color,count){
  for(let i=0;i<count;i++){
    particles.push({x,y,vx:(Math.random()-0.5)*6,vy:(Math.random()-0.5)*6,
      life:40,color});
  }
}
function updateParticles(){
  particles.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.life--;});
  particles=particles.filter(p=>p.life>0);
  particles.forEach(p=>{
    ctx.fillStyle=p.color; ctx.globalAlpha=p.life/40;
    ctx.fillRect(p.x,p.y,3,3); ctx.globalAlpha=1;
  });
}

// Floating score
function spawnFloatingScore(val){
  floatingScores.push({x:canvas.width/2+60,y:50,text:"+"+val,life:40});
}
function updateFloatingScores(){
  floatingScores.forEach(f=>{f.y-=0.5;f.life--;});
  floatingScores=floatingScores.filter(f=>f.life>0);
  ctx.fillStyle="yellow"; ctx.textAlign="left"; ctx.font="12px 'Press Start 2P'";
  floatingScores.forEach(f=>{ctx.fillText(f.text,f.x,f.y);});
}

// Trails
function spawnTrail(x,y){
  trails.push({x,y,life:25});
}
function updateTrails(){
  trails.forEach(t=>{t.life--;});
  trails=trails.filter(t=>t.life>0);
  trails.forEach(t=>{
    ctx.fillStyle="rgba(255,255,255,"+(t.life/25)+")";
    ctx.fillRect(t.x-2,t.y-2,4,4);
  });
}

// Strike
class Strike{
  constructor(type,lane){
    this.type=type; this.lane=lane; this.active=true; this.size=40; this.x=canvas.width+60;
    this.y=(lane===0?topGroundY:bottomGroundY)-(lane===0?0:this.size);
    this.timer=0; this.jumped=false;
  }
  update(){
    this.x-=(this.type==="purple"?scrollSpeed*1.5:scrollSpeed);
    this.timer++;
    if(this.type==="purple" && !this.jumped && this.x<canvas.width/2){
      this.lane=this.lane===0?1:0; this.y=(this.lane===0?topGroundY:bottomGroundY)-(this.lane===0?0:this.size);
      this.jumped=true;
    }
  }
  draw(){
    let color="red";
    if(this.type==="purple") color="purple";
    if(this.type==="white") color=Math.sin(this.timer/10)>0?"white":"gray";
    ctx.fillStyle=color; ctx.shadowColor=color; ctx.shadowBlur=15;
    ctx.beginPath();
    if(this.lane===0){ // top ground, hanging
      ctx.moveTo(this.x,this.y);
      ctx.lineTo(this.x-this.size/2,this.y+this.size);
      ctx.lineTo(this.x+this.size/2,this.y+this.size);
    }else{ // bottom ground, standing
      ctx.moveTo(this.x,this.y+this.size);
      ctx.lineTo(this.x-this.size/2,this.y);
      ctx.lineTo(this.x+this.size/2,this.y);
    }
    ctx.closePath(); ctx.fill(); ctx.shadowBlur=0;
  }
}

// Gems
class Gem{
  constructor(x){
    this.x=x; this.y=(topGroundY+bottomGroundY)/2; this.size=12; this.collected=false;
  }
  update(){
    this.x-=scrollSpeed;
    if(!this.collected && Math.abs(this.x-player.x)<25 && Math.abs(this.y-player.y)<25){
      this.collected=true; spawnParticles(this.x,this.y,"white",30);
      score+=10; spawnFloatingScore(10);
    }
  }
  draw(){
    if(!this.collected){
      ctx.save(); ctx.translate(this.x,this.y); ctx.rotate(Math.PI/4);
      ctx.fillStyle="white"; ctx.shadowColor="white"; ctx.shadowBlur=20;
      ctx.fillRect(-this.size/2,-this.size/2,this.size,this.size);
      ctx.restore(); ctx.shadowBlur=0;
    }
  }
}

// Ground
function drawGround(){
  ctx.fillStyle="white"; ctx.shadowColor="white"; ctx.shadowBlur=15;
  ctx.fillRect(0,topGroundY-groundHeight,canvas.width,groundHeight);
  ctx.fillRect(0,bottomGroundY,canvas.width,groundHeight);
  ctx.shadowBlur=0;
}

// Player
function drawPlayer(){
  player.y+=(player.targetY-player.y)*0.2;
  spawnTrail(player.x,player.y);
  ctx.fillStyle="white"; ctx.shadowColor="white"; ctx.shadowBlur=15;
  ctx.fillRect(player.x-player.width/2,player.y-player.height,player.width,player.height);
  ctx.shadowBlur=0;
}

// Score
function drawScore(){
  ctx.font="20px 'Press Start 2P'"; ctx.fillStyle="white"; ctx.textAlign="center";
  ctx.fillText(score,canvas.width/2,50);
}

// Collision
function checkCollisions(){
  for(let s of strikes){
    if(!s.active) continue;
    let dx=Math.abs(player.x-s.x), dy=Math.abs(player.y-s.y);
    if(dx<player.width/2+15 && dy<player.height/2+15){
      gameRunning=false;
      spawnParticles(player.x,player.y,"white",60);
      if(score>bestScore){ localStorage.setItem("ghostTrainBest",score); }
      setTimeout(()=>{ alert("You Died! Score: "+score); location.reload(); },100);
    }
  }
}

// Spawning
let lastSpawnCol=0;
function getNextSpawnCol(){ return lastSpawnCol+1+Math.floor(Math.random()*5); }
function spawnThing(){
  let choice=Math.random();
  if(choice<0.8) spawnStrike(); else spawnGem();
}
function spawnStrike(){
  let lane=Math.random()<0.5?0:1;
  let t=Math.random(); let type="red";
  if(t>0.7 && t<0.9) type="purple";
  if(t>=0.9) type="white";
  strikes.push(new Strike(type,lane));
}
function spawnGem(){ gems.push(new Gem(canvas.width+60)); }

// Input
const keyState={};
document.addEventListener("keydown",e=>{
  if(!gameRunning) return;
  if(keyState[e.key]) return;
  keyState[e.key]=true;
  if(["w"," ","ArrowUp"].includes(e.key)) switchLane();
  if(["q","Tab"].includes(e.key)) destroyNearbyWhite();
});
document.addEventListener("keyup",e=>{ keyState[e.key]=false; });
document.addEventListener("mousedown",()=>{ if(gameRunning) switchLane(); });
document.getElementById("strikeButton").addEventListener("click",destroyNearbyWhite);

// Switch lane
function switchLane(){
  player.lane=player.lane===0?1:0;
  player.targetY=(player.lane===0?topGroundY:bottomGroundY)-30;
  spawnParticles(player.x,player.y,"white",15);
  score+=1; spawnFloatingScore(1);
}

// Destroy white
function destroyNearbyWhite(){
  for(let s of strikes){
    if(s.type==="white" && Math.abs(s.x-player.x)<80){ s.active=false; spawnParticles(s.x,s.y,"white",50); }
  }
  strikes=strikes.filter(s=>s.active);
}

// Game loop
function gameLoop(){
  if(!gameRunning) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawGround(); drawPlayer(); updateTrails();
  for(let s of strikes){ s.update(); s.draw(); }
  strikes=strikes.filter(s=>s.x>-100 && s.active);
  for(let g of gems){ g.update(); g.draw(); }
  gems=gems.filter(g=>g.x>-100 && !g.collected);
  updateParticles(); updateFloatingScores(); drawScore(); checkCollisions();
  requestAnimationFrame(gameLoop);
}

// UI
document.getElementById("startBtn").onclick=()=>{
  document.getElementById("ui").style.display="none";
  document.getElementById("strikeButton").style.display="block";
  gameRunning=true; setInterval(spawnThing,1500); gameLoop();
};
document.getElementById("howToBtn").onclick=()=>{ document.getElementById("howToPlayBox").style.display="block"; };
document.getElementById("closeHowTo").onclick=()=>{ document.getElementById("howToPlayBox").style.display="none"; };

// Resize
window.addEventListener("resize",()=>{ canvas.width=window.innerWidth; canvas.height=window.innerHeight; });
</script>
</body>
</html>
