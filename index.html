<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Login | Classlink</title>
<link rel="icon" type="image/png" href="pausd-icon.png">
<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

body {
  margin:0; overflow:hidden; background:black;
  font-family: 'Press Start 2P', cursive; color:white;
}
canvas { display:block; }

#ui {
  position:absolute; top:0; left:0; width:100%; height:100%;
  background:black; display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:10;
}
.button {
  background:transparent; color:white; font-size:16px;
  padding:16px; margin:10px; width:260px; text-align:center;
  border:3px solid white; border-radius:8px; cursor:pointer;
  text-shadow: 0 0 10px white; box-shadow: 0 0 10px white; transition:0.3s;
}
.button:hover { text-shadow: 0 0 20px white; box-shadow: 0 0 20px white; }
#bestScore { margin-top:10px; font-size:12px; color:white; text-shadow:0 0 8px purple; }
#howToPlayBox {
  position:absolute; top:10%; left:20%; width:60%; height:70%;
  background:black; color:white; border-radius:16px; padding:20px;
  overflow-y:auto; box-shadow:0 0 40px purple; display:none; z-index:20;
}
#closeHowTo { position:absolute; top:10px; right:20px; font-size:24px; cursor:pointer; color:purple; }
#strikeButton {
  position:absolute; bottom:40px; right:40px; width:80px; height:80px; border-radius:50%;
  background: radial-gradient(circle, purple 40%, transparent 70%);
  box-shadow:0 0 30px purple; border:3px solid purple; cursor:pointer; display:none; z-index:5;
  animation: glowPulse 1.2s infinite;
}
@keyframes glowPulse {
  0% { box-shadow:0 0 15px purple; }
  50% { box-shadow:0 0 35px purple; }
  100% { box-shadow:0 0 15px purple; }
}
</style>
</head>
<body>
<div id="ui">
  <div class="button" id="startBtn">START</div>
  <div class="button" id="howToBtn">HOW TO PLAY</div>
  <div id="bestScore">Best Score: 0</div>
</div>

<div id="howToPlayBox">
  <div id="closeHowTo">✕</div>
  <h2>How to Play</h2>
  <p>
    Welcome to <b>Ghost Train Cube</b>.<br><br>
    - Move between top and bottom glowing platforms using <b>W / Space / ↑</b> or click/tap.<br>
    - Avoid red strikes.<br>
    - Purple strikes jump lanes leaving a glowing path line.<br>
    - White strikes pulse; destroy them with <b>Q / Tab</b> or the purple button.<br>
    - Collect gems floating in the middle while switching platforms.<br>
    - Score: +1 each lane switch, +10 for gem collected.<br>
    - Enjoy glowing particles, smooth animations, and neon effects!
  </p>
</div>

<div id="strikeButton"></div>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let gameRunning=false, particles=[], gems=[], strikes=[], floatingScores=[];
let scrollSpeed=6, blockSize=50, score=0;
let bestScore = localStorage.getItem("ghostTrainBest")||0;
document.getElementById("bestScore").textContent="Best Score: "+bestScore;

const groundHeight = 80;
const topGroundY = canvas.height*0.25;
const bottomGroundY = canvas.height*0.75;
let player={x:canvas.width*0.2, y:bottomGroundY-groundHeight, lane:1, size:40, targetY:bottomGroundY-groundHeight, vy:0};

function resetPlayer(){ player.lane=1; player.y=bottomGroundY-groundHeight; player.targetY=bottomGroundY-groundHeight; player.vy=0; score=0; }

// Particles
function spawnParticles(x,y,color,count=20){
  for(let i=0;i<count;i++) particles.push({x,y,dx:(Math.random()-0.5)*6,dy:(Math.random()-0.5)*6,size:Math.random()*6+2,life:40,color});
}
function updateParticles(){
  particles=particles.filter(p=>p.life>0);
  for(let p of particles){
    p.x+=p.dx; p.y+=p.dy; p.life--;
    ctx.fillStyle=p.color; ctx.shadowColor=p.color; ctx.shadowBlur=20;
    ctx.beginPath(); ctx.arc(p.x,p.y,p.size,0,Math.PI*2); ctx.fill(); ctx.shadowBlur=0;
  }
}

// Floating score
function spawnFloatingScore(val){ floatingScores.push({ val, x:canvas.width/2+60, y:topGroundY-40, alpha:1 }); }
function updateFloatingScores(){
  for(let f of floatingScores){ f.y-=0.5; f.alpha-=0.02;
    ctx.font="16px 'Press Start 2P'"; ctx.fillStyle="yellow"; ctx.globalAlpha=f.alpha;
    ctx.shadowColor="yellow"; ctx.shadowBlur=10; ctx.fillText("+"+f.val,f.x,f.y); ctx.shadowBlur=0; ctx.globalAlpha=1;
  }
  floatingScores=floatingScores.filter(f=>f.alpha>0);
}

// Strikes
class Strike{
  constructor(type,lane){
    this.type=type; this.lane=lane;
    this.x=canvas.width+100; this.y=lane===0?topGroundY-groundHeight:bottomGroundY-groundHeight; this.size=50;
    this.active=true; this.timer=0; this.pathPoints=[]; this.moving=false;
  }
  update(){
    this.x-=scrollSpeed;
    if(this.type==="purple"){
      let dist=this.x-player.x;
      if(dist<blockSize*4 && dist>0 && this.lane===player.lane && !this.moving){
        let targetLane=this.lane===0?1:0, startY=this.y, endY=targetLane===0?topGroundY-groundHeight:bottomGroundY-groundHeight;
        let frames=20; this.pathPoints=[];
        for(let i=0;i<=frames;i++){ let t=i/frames; let y=startY+(endY-startY)*t + 20*Math.sin(t*Math.PI*2); this.pathPoints.push(y); }
        this.moving=true; this.jumpFrame=0; this.lane=targetLane;
      }
      if(this.moving){ this.y=this.pathPoints[this.jumpFrame]||this.y; this.jumpFrame++; if(this.jumpFrame>=this.pathPoints.length) this.moving=false; }
    }
    if(this.type==="white") this.timer++;
  }
  draw(){
    if(this.type==="purple" && this.moving){
      ctx.strokeStyle="purple"; ctx.lineWidth=2; ctx.shadowColor="purple"; ctx.shadowBlur=10;
      ctx.beginPath(); ctx.moveTo(this.x+scrollSpeed, this.pathPoints[0]);
      for(let i=1;i<this.jumpFrame;i++) ctx.lineTo(this.x+scrollSpeed-i, this.pathPoints[i]); ctx.stroke(); ctx.shadowBlur=0;
    }
    ctx.shadowBlur=20;
    if(this.type==="red"){ ctx.fillStyle="red"; ctx.shadowColor="red"; }
    if(this.type==="purple"){ ctx.fillStyle="purple"; ctx.shadowColor="purple"; }
    if(this.type==="white"){ ctx.fillStyle=Math.sin(this.timer/10)>0?"white":"gray"; ctx.shadowColor="white"; }
    ctx.fillRect(this.x-this.size/2,this.y-this.size/2,this.size,this.size); ctx.shadowBlur=0;
  }
}

// Gems
class Gem{
  constructor(x){ this.x=x; this.y=canvas.height/2; this.size=20; this.collected=false; this.ay=Math.random()*0.05; }
  update(){ this.x-=scrollSpeed; this.y+=Math.sin(Date.now()/200)*2;
    if(!this.collected && Math.abs(this.x-player.x)<30 && Math.abs(this.y-player.y)<30){ this.collected=true; spawnParticles(this.x,this.y,"aqua",30); score+=10; spawnFloatingScore(10); }
  }
  draw(){ if(!this.collected){ ctx.fillStyle="aqua"; ctx.shadowColor="aqua"; ctx.shadowBlur=20; ctx.beginPath(); ctx.arc(this.x,this.y,this.size,0,Math.PI*2); ctx.fill(); ctx.shadowBlur=0; } }
}

// Spawn
function spawnStrike(){ let t=Math.random(); let type="red"; if(t>0.7 && t<0.9) type="purple"; if(t>=0.9) type="white"; let lane=Math.random()<0.5?0:1; strikes.push(new Strike(type,lane)); }
function spawnGem(){ gems.push(new Gem(canvas.width+100)); }

// Draw
function drawPlayer(){
  player.vy += (player.targetY-player.y)*0.2; player.y+=player.vy; player.vy*=0.7;
  ctx.fillStyle="white"; ctx.shadowColor="white"; ctx.shadowBlur=20;
  ctx.fillRect(player.x-player.size/2,player.y-player.size/2,player.size,player.size); ctx.shadowBlur=0;
  spawnParticles(player.x-10,player.y,"white",1);
}
function drawGround(){
  ctx.fillStyle="white"; ctx.shadowColor="white"; ctx.shadowBlur=20;
  ctx.fillRect(0,topGroundY-groundHeight,canvas.width,groundHeight);
  ctx.fillRect(0,bottomGroundY-groundHeight,canvas.width,groundHeight); ctx.shadowBlur=0;
}
function drawScore(){ ctx.font="24px 'Press Start 2P'"; ctx.fillStyle="white"; ctx.shadowColor="white"; ctx.shadowBlur=20; ctx.textAlign="center"; ctx.fillText(score,canvas.width/2,topGroundY-10); ctx.shadowBlur=0; }

// Game Loop
function gameLoop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawGround(); drawPlayer();
  for(let s of strikes){ s.update(); s.draw(); }
  strikes=strikes.filter(s=>s.x>-100 && s.active);
  for(let g of gems){ g.update(); g.draw(); }
  gems=gems.filter(g=>g.x>-100 && !g.collected);
  updateParticles(); updateFloatingScores(); drawScore();
  requestAnimationFrame(gameLoop);
}

// Input
function switchLane(){ player.lane=player.lane===0?1:0; player.targetY=player.lane===0?topGroundY-groundHeight:bottomGroundY-groundHeight; spawnParticles(player.x,player.y,"white",30); score+=1; spawnFloatingScore(1); }
document.addEventListener("keydown", e=>{ if(!gameRunning) return; if(["w"," ","ArrowUp"].includes(e.key)) switchLane(); if(["q","Tab"].includes(e.key)) destroyNearbyWhite(); });
document.addEventListener("click", e=>{ if(!gameRunning) return; switchLane(); });
function destroyNearbyWhite(){ for(let s of strikes){ if(s.type==="white" && Math.abs(s.x-player.x)<blockSize && s.lane===player.lane){ s.active=false; spawnParticles(s.x,s.y,"white",50); } } strikes=strikes.filter(s=>s.active); }
document.getElementById("strikeButton").addEventListener("click",destroyNearbyWhite);

// UI
document.getElementById("startBtn").onclick = ()=>{
  document.getElementById("ui").style.display="none"; document.getElementById("strikeButton").style.display="block";
  gameRunning=true; resetPlayer(); setInterval(spawnStrike,2000); setInterval(spawnGem,3500); gameLoop();
};
document.getElementById("howToBtn").onclick = ()=>{ document.getElementById("howToPlayBox").style.display="block"; };
document.getElementById("closeHowTo").onclick = ()=>{ document.getElementById("howToPlayBox").style.display="none"; };
window.addEventListener("resize", ()=>{ canvas.width=window.innerWidth; canvas.height=window.innerHeight; });

// Best score
window.addEventListener("beforeunload", ()=>{ if(score>bestScore){ localStorage.setItem("ghostTrainBest", score); } });
</script>
</body>
</html>
